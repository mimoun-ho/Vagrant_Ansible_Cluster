require 'yaml'

# Charger les configurations depuis config.yml
config_data = YAML.load_file('config.yml')

# Vagrantfile pour le serveur edge
Vagrant.configure("2") do |config|
  config.vm.define "Edge" do |edge|
    edge.vm.box = "bento/ubuntu-20.04"
    edge.vm.hostname = "Edge#{config_data['localhost_name']}"
    edge.vm.network "private_network", ip: "#{config_data['ip_range']}.99"

    edge.vm.provider "virtualbox" do |vb|
      vb.name = "Edge_ubuntu-20.04"  # Nom de la machine dans VirtualBox
      vb.memory = config_data['memory']   # Taille de la RAM (en Mo)
      vb.cpus = config_data['cpu']        # Nombre de processeurs
    end

    # Installation d'Ansible
    edge.vm.provision "shell", inline: <<-SHELL
      sudo apt update
      sudo apt install -y ansible
    SHELL

    # Utilisation du script setup_ansible_user.sh
    edge.vm.provision "shell", path: "../setup_ansible_user.sh"
  end
end
